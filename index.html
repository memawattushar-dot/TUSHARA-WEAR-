<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TUSHARA-WEAR AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§ê‡§™</title>
    <!-- Tailwind CSS ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ‡§¨‡•ç‡§∞‡§æ‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§î‡§∞ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤‡§¨‡§æ‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .chat-container {
            max-height: calc(100vh - 160px); /* ‡§á‡§®‡§™‡•Å‡§ü ‡§î‡§∞ ‡§π‡•á‡§°‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ä‡§Ç‡§ö‡§æ‡§à ‡§∏‡§Æ‡§æ‡§Ø‡•ã‡§ú‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç */
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        /* Tushara ‡§¨‡•ç‡§∞‡§æ‡§Ç‡§° ‡§∞‡§Ç‡§ó */
        .brand-bg {
            background-color: #1e3a8a; /* ‡§ó‡§π‡§∞‡§æ ‡§®‡•Ä‡§≤‡§æ */
        }
        .brand-text-accent {
            color: #f59e0b; /* ‡§è‡§Æ‡•ç‡§¨‡§∞/‡§ó‡•ã‡§≤‡•ç‡§° ‡§è‡§ï‡•ç‡§∏‡•á‡§Ç‡§ü */
        }
        .brand-bg-accent {
            background-color: #f59e0b;
        }
        .user-message {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        .ai-message {
            background-color: #1e3a8a;
            color: white;
        }
    </style>
    <!-- PWA ‡§Æ‡•à‡§®‡§ø‡§´‡•á‡§∏‡•ç‡§ü ‡§î‡§∞ ‡§•‡•Ä‡§Æ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ (‡§ï‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§π‡•ã‡§Ç‡§ó‡•Ä) -->
    <meta name="theme-color" content="#1e3a8a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
</head>
<body class="min-h-screen flex flex-col">

    <!-- ‡§π‡•á‡§°‡§∞ (Header) -->
    <header class="brand-bg text-white p-4 shadow-lg sticky top-0 z-10">
        <h1 class="text-xl font-bold">TUSHARA-WEAR AI <span class="brand-text-accent">‡§∏‡§π‡§æ‡§Ø‡§ï</span></h1>
        <p class="text-sm opacity-80">‡§π‡§Æ‡§æ‡§∞‡•á ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡•ã‡§Ç, ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§Ø‡§æ ‡§´‡•à‡§∂‡§® ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§</p>
    </header>

    <!-- ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§ö‡•à‡§ü ‡§°‡§ø‡§∏‡•ç‡§™‡•ç‡§≤‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ (Main Chat Display Area) -->
    <main class="flex-grow p-4 md:p-6 pb-20">
        <div id="chat-container" class="chat-container space-y-4">
            <!-- ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§‡•Ä ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§∏‡§Ç‡§¶‡•á‡§∂ -->
            <div class="flex justify-start">
                <div class="ai-message p-3 rounded-xl rounded-tl-none max-w-xs md:max-w-md shadow-md">
                    üëã **‡§®‡§Æ‡§∏‡•ç‡§§‡•á!** ‡§Æ‡•à‡§Ç TUSHARA-WEAR ‡§ï‡§æ AI ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Å‡•§ ‡§Ö‡§™‡§®‡•Ä ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤‡§ø‡§Ç‡§ó ‡§ï‡•Ä ‡§ú‡§º‡§∞‡•Ç‡§∞‡§§‡•ã‡§Ç ‡§Ø‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§´‡•à‡§∂‡§® ‡§ü‡•ç‡§∞‡•á‡§Ç‡§° ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§
                </div>
            </div>
            <!-- ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•á ‡§ú‡§æ‡§è‡§Å‡§ó‡•á -->
        </div>
        
        <!-- ‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó ‡§á‡§Ç‡§°‡§ø‡§ï‡•á‡§ü‡§∞ -->
        <div id="loading-indicator" class="hidden flex justify-start mt-4">
            <div class="p-3 bg-gray-200 rounded-xl rounded-tl-none max-w-xs md:max-w-md shadow-md">
                <div class="flex space-x-1">
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: -0.32s;"></div>
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce" style="animation-delay: -0.16s;"></div>
                    <div class="w-2 h-2 bg-gray-500 rounded-full animate-bounce"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ (Input Area - Sticky Footer) -->
    <div class="fixed bottom-0 left-0 w-full bg-white p-4 shadow-2xl z-20">
        <div class="flex space-x-3 max-w-4xl mx-auto">
            <input 
                type="text" 
                id="user-input" 
                placeholder="‡§Ö‡§™‡§®‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§Ø‡§π‡§æ‡§Å ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç..." 
                class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#f59e0b] focus:border-[#f59e0b]"
                onkeydown="if(event.key === 'Enter') document.getElementById('send-btn').click();"
            >
            <button 
                id="send-btn" 
                onclick="sendMessage()" 
                class="brand-bg-accent text-white p-3 rounded-lg font-semibold shadow-md hover:bg-yellow-600 transition duration-150 flex items-center justify-center disabled:opacity-50"
            >
                ‡§≠‡•á‡§ú‡•á‡§Ç
            </button>
        </div>
        <p id="status-message" class="text-xs text-gray-500 mt-2 text-center hidden">AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à...</p>
    </div>

    <!-- JavaScript ‡§≤‡•â‡§ú‡§ø‡§ï: AI, PWA ‡§î‡§∞ ‡§ö‡•à‡§ü‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è -->
    <script>
        // --- 1. AI ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞‡•á‡§∂‡§® ‡§î‡§∞ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø (AI Configuration and State) ---
        const API_KEY = ""; // Key ‡§ñ‡§æ‡§≤‡•Ä ‡§∞‡§ñ‡•á‡§Ç, Canvas ‡§á‡§∏‡•á ‡§Ö‡§™‡§®‡•á ‡§Ü‡§™ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§ó‡§æ
        const MODEL = 'gemini-2.5-flash-preview-09-2025';
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;
        
        let chatHistory = [];
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-btn');
        const statusMessage = document.getElementById('status-message');
        const loadingIndicator = document.getElementById('loading-indicator');
        
        const systemInstruction = "TUSHARA-WEAR ‡§ï‡•á ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•á‡§µ‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§®‡§ø‡§ß‡§ø ‡§î‡§∞ ‡§´‡•à‡§∂‡§® ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§ï‡§æ‡§∞‡•ç‡§Ø ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§, ‡§Æ‡•à‡§§‡•ç‡§∞‡•Ä‡§™‡•Ç‡§∞‡•ç‡§£ ‡§î‡§∞ ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§∏‡§≤‡§æ‡§π ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è Google Search ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§´‡•à‡§∂‡§® ‡§ü‡•ç‡§∞‡•á‡§Ç‡§°‡•ç‡§∏ ‡§™‡§∞ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§¶‡•á‡§Ç, ‡§≤‡•á‡§ï‡§ø‡§® ‡§π‡§Æ‡•á‡§∂‡§æ ‡§á‡§∏‡•á ‡§™‡•Å‡§∞‡•Å‡§∑‡•ã‡§Ç ‡§ï‡•á ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§î‡§∞ ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡•á‡§Ç‡•§ ‡§π‡§ø‡§Ç‡§¶‡•Ä (‡§¶‡•á‡§µ‡§®‡§æ‡§ó‡§∞‡•Ä) ‡§Æ‡•á‡§Ç ‡§ú‡§µ‡§æ‡§¨ ‡§¶‡•á‡§Ç‡•§";

        // --- Utility Functions ---

        /** ‡§ö‡•à‡§ü ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•ã ‡§®‡•Ä‡§ö‡•á ‡§§‡§ï ‡§∏‡•ç‡§ï‡•ç‡§∞‡•â‡§≤ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ */
        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        /** ‡§ö‡•à‡§ü ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§¨‡§¨‡§≤ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§ú‡•ã‡§°‡§º‡§§‡§æ ‡§π‡•à‡•§ */
        function appendMessage(role, text, sources = []) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;

            const messageBubble = document.createElement('div');
            messageBubble.className = `p-3 rounded-xl max-w-xs md:max-w-md shadow-md transition-all duration-300 ${
                role === 'user' 
                    ? 'user-message rounded-br-none' 
                    : 'ai-message rounded-tl-none'
            }`;
            messageBubble.innerHTML = role === 'user' ? text : formatMarkdown(text);
            
            messageWrapper.appendChild(messageBubble);

            if (sources.length > 0 && role !== 'user') {
                const sourcesDiv = document.createElement('div');
                sourcesDiv.className = 'text-xs mt-1 p-2 bg-gray-100 rounded-lg border border-gray-200 text-black';
                sourcesDiv.innerHTML = '<strong>üîç ‡§∏‡•ç‡§∞‡•ã‡§§:</strong><ul class="list-disc ml-4 mt-1 space-y-0.5">' + 
                    sources.map(s => `<li><a href="${s.uri}" target="_blank" class="text-blue-600 hover:underline">${s.title || s.uri}</a></li>`).join('') +
                    '</ul>';
                messageWrapper.appendChild(sourcesDiv);
            }

            chatContainer.appendChild(messageWrapper);
            scrollToBottom();
        }

        /** AI ‡§∞‡§ø‡§∏‡•ç‡§™‡•â‡§®‡•ç‡§∏ ‡§´‡§º‡•â‡§∞‡•ç‡§Æ‡•á‡§ü‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§Æ‡§æ‡§∞‡•ç‡§ï‡§°‡§æ‡§â‡§® ‡§ï‡•ã HTML ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡§§‡§æ ‡§π‡•à‡•§ */
        function formatMarkdown(text) {
            // ‡§¨‡•ã‡§≤‡•ç‡§° (**text** or *text*)
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            text = text.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
            // ‡§®‡§à ‡§≤‡§æ‡§á‡§® ‡§ï‡•ã ‡§¨‡•ç‡§∞‡•á‡§ï ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç
            text = text.replace(/\n/g, '<br>');
            return text;
        }

        // --- 2. AI ‡§á‡§Ç‡§ü‡§∞‡•à‡§ï‡•ç‡§∂‡§® ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§≤‡•â‡§ú‡§ø‡§ï (AI Interaction Core Logic) ---

        /** Gemini API ‡§ï‡•ã ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡§§‡§æ ‡§π‡•à‡•§ */
        async function fetchAIResponse(userQuery) {
            
            // ‡§™‡•á‡§≤‡•ã‡§° ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡•ã ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
            chatHistory.push({ role: "user", parts: [{ text: userQuery }] });

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                
                // ‡§®‡§µ‡•Ä‡§®‡§§‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è Google Search ‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡•á‡§Ç
                tools: [{ "google_search": {} }], 
                
                systemInstruction: {
                    parts: [{ text: systemInstruction }]
                },
            };

            let response;
            let result;
            let delay = 1000;
            const maxRetries = 3;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) {
                        // ‡§¨‡§π‡•Å‡§§ ‡§Ö‡§ß‡§ø‡§ï ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß - ‡§ò‡§æ‡§§‡•Ä‡§Ø ‡§¨‡•à‡§ï‡§ë‡§´‡§º
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                        continue; 
                    }

                    if (!response.ok) {
                        throw new Error(`API ‡§®‡•á ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ${response.status} ‡§µ‡§æ‡§™‡§∏ ‡§ï‡•Ä`);
                    }

                    result = await response.json();
                    break; // ‡§∏‡§´‡§≤‡§§‡§æ, ‡§≤‡•Ç‡§™ ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§®‡§ø‡§ï‡§≤‡•á‡§Ç

                } catch (error) {
                    // console.error("Fetch ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§µ‡§ø‡§´‡§≤:", error); // ‡§°‡•Ä‡§¨‡§ó‡§ø‡§Ç‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§õ‡•ã‡§°‡§º ‡§¶‡§ø‡§Ø‡§æ
                    if (i === maxRetries - 1) {
                        throw new Error("‡§ï‡§à ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤ ‡§∞‡§π‡§æ‡•§");
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
            
            if (!result || !result.candidates || result.candidates.length === 0) {
                 throw new Error("API ‡§∏‡•á ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ‡•§");
            }

            const candidate = result.candidates[0];
            const text = candidate.content?.parts?.[0]?.text || "‡§ï‡•ç‡§∑‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§Æ‡•à‡§Ç ‡§â‡§∏ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡•ã ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∏‡§ï‡§æ‡•§";

            let sources = [];
            const groundingMetadata = candidate.groundingMetadata;
            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                sources = groundingMetadata.groundingAttributions
                    .map(attribution => ({
                        uri: attribution.web?.uri,
                        title: attribution.web?.title,
                    }))
                    .filter(source => source.uri); 
            }

            // AI ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
            chatHistory.push({ role: "model", parts: [{ text: text }] });
            
            return { text, sources };
        }

        /** ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡§®‡•á ‡§î‡§∞ UI ‡§ï‡•ã ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•ã ‡§∏‡§Ç‡§≠‡§æ‡§≤‡§§‡§æ ‡§π‡•à‡•§ */
        async function sendMessage() {
            const query = userInput.value.trim();
            if (!query) return;

            // 1. ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡•á ‡§≤‡§ø‡§è UI ‡§Ö‡§™‡§°‡•á‡§ü
            appendMessage('user', query);
            userInput.value = '';
            userInput.disabled = true;
            sendButton.disabled = true;
            statusMessage.classList.remove('hidden');
            loadingIndicator.classList.remove('hidden');
            scrollToBottom();

            try {
                // 2. AI ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
                const { text, sources } = await fetchAIResponse(query);
                
                // 3. AI ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è UI ‡§Ö‡§™‡§°‡•á‡§ü
                appendMessage('ai', text, sources);

            } catch (error) {
                console.error("Gemini API ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", error);
                appendMessage('ai', `**‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:** AI ‡§ï‡•ã ‡§è‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à: ${error.message}‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§`);
            } finally {
                // 4. UI ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                userInput.disabled = false;
                sendButton.disabled = false;
                statusMessage.classList.add('hidden');
                loadingIndicator.classList.add('hidden');
                userInput.focus();
            }
        }

        // --- 3. PWA ‡§∏‡•á‡§ü‡§Ö‡§™ (‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£) ---
        
        /** ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§´‡§º‡§æ‡§á‡§≤ ‡§ï‡•Ä ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä, ‡§è‡§ï ‡§´‡§º‡§Ç‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§‡•§ */
        function getServiceWorkerContent() {
            const CACHE_NAME = 'tushara-wear-cache-v1';
            // ‡§ë‡§´‡§º‡§≤‡§æ‡§á‡§® ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•à‡§∂ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§´‡§º‡§æ‡§á‡§≤‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä
            const urlsToCache = [
                '/TUSHARA-WEAR/',
                '/TUSHARA-WEAR/index.html',
                'https://cdn.tailwindcss.com', 
            ];

            // ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§≤‡•â‡§ú‡§ø‡§ï
            return `
                const CACHE_NAME = '${CACHE_NAME}';
                const urlsToCache = [${urlsToCache.map(url => `'${url}'`).join(', ')}];

                self.addEventListener('install', event => {
                    console.log('[Service Worker] Installing...');
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(cache => cache.addAll(urlsToCache))
                            .catch(err => console.error('Cache addAll failed:', err))
                    );
                });

                self.addEventListener('fetch', event => {
                    event.respondWith(
                        caches.match(event.request).then(response => {
                            return response || fetch(event.request);
                        })
                    );
                });

                self.addEventListener('activate', event => {
                    const cacheWhitelist = [CACHE_NAME];
                    event.waitUntil(
                        caches.keys().then(cacheNames => {
                            return Promise.all(
                                cacheNames.map(cacheName => {
                                    if (cacheWhitelist.indexOf(cacheName) === -1) {
                                        return caches.delete(cacheName);
                                    }
                                })
                            );
                        })
                    );
                });
            `;
        }

        /** PWA ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§ï‡•ã ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§ */
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    try {
                        // ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§∏‡•á Blob ‡§¨‡§®‡§æ‡§è‡§Å
                        const swContent = getServiceWorkerContent();
                        const swBlob = new Blob([swContent], { type: 'application/javascript' });
                        const swUrl = URL.createObjectURL(swBlob);

                        // ‡§∏‡§∞‡•ç‡§µ‡§ø‡§∏ ‡§µ‡§∞‡•ç‡§ï‡§∞ ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç
                        navigator.serviceWorker.register(swUrl, { scope: '/TUSHARA-WEAR/' })
                            .then(registration => {
                                console.log('PWA ServiceWorker registered successfully:', registration.scope);
                            })
                            .catch(error => {
                                console.error('PWA ServiceWorker registration failed:', error);
                            });
                        
                        // ‡§Æ‡•à‡§®‡§ø‡§´‡•á‡§∏‡•ç‡§ü ‡§ï‡•ã ‡§°‡§æ‡§Ø‡§®‡§æ‡§Æ‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§Ü‡§á‡§ï‡§® ‡§™‡•ç‡§≤‡•á‡§∏‡§π‡•ã‡§≤‡•ç‡§°‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á)
                        const manifest = {
                            "name": "TUSHARA-WEAR",
                            "short_name": "Tushara",
                            "description": "TUSHARA Menswear - AI Assistant PWA",
                            "start_url": "/TUSHARA-WEAR/",
                            "display": "standalone",
                            "background_color": "#ffffff",
                            "theme_color": "#1e3a8a",
                            "icons": [
                                { "src": "https://placehold.co/192x192/1e3a8a/ffffff?text=T", "sizes": "192x192", "type": "image/png" },
                                { "src": "https://placehold.co/512x512/1e3a8a/ffffff?text=T", "sizes": "512x512", "type": "image/png" }
                            ]
                        };
                        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
                        const manifestUrl = URL.createObjectURL(manifestBlob);
                        
                        const link = document.createElement('link');
                        link.rel = 'manifest';
                        link.href = manifestUrl;
                        document.head.appendChild(link);
                        
                    } catch (e) {
                        console.error("PWA ‡§∏‡•á‡§ü‡§Ö‡§™ ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", e);
                    }
                });
            }
        }

        // ‡§µ‡§ø‡§Ç‡§°‡•ã ‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§™‡§∞ PWA ‡§ï‡•ã ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
        registerServiceWorker();
    </script>

</body>
</html>

    
